N0REP0
### ### Try to keep synchronised with pin-depends-ignore
### opam option default-invariant=[]
Set to '[]' the field default-invariant in global configuration
### unset OPAMCONFIRMLEVEL
### :I: Local install with pin depends
### <pin:pin-dep/opam>
opam-version: "2.0"
### <pin:local-with-pin-deps/opam>
opam-version: "2.0"
depends: "pin-dep"
### <add-pin-depends.sh>
basedir=$(printf '%s' "$BASEDIR" | sed 's/\\/\\\\/g')
cat >> local-with-pin-deps/opam << EOF
pin-depends: ["pin-dep.dev" "file://$basedir/pin-dep"]
EOF
### sh add-pin-depends.sh
### :I:1: Dependent package not present in repo
### opam switch create pin-deps-wo-repo-empty --empty
### :I:1:a: Show
### opam install --show ./local-with-pin-deps
[ERROR] Package conflict!
  * Missing dependency:
    - local-with-pin-deps -> pin-dep
    unknown package

No solution found, exiting
# Return code 20 #
### opam pin
### :I:1:b: Dry run
### opam install --dry-run ./local-with-pin-deps
[ERROR] Package conflict!
  * Missing dependency:
    - local-with-pin-deps -> pin-dep
    unknown package

No solution found, exiting
# Return code 20 #
### opam pin
### :I:1:c: Deps only without pin depends
### opam switch create pin-deps-I-1-c --empty
### OPAMAUTOANSWER=install-pin-depends=no:ignore-pin-depends=yes opam install --deps-only ./local-with-pin-deps
The following additional pinnings are required by local-with-pin-deps.dev:
  - pin-dep.dev at file://${BASEDIR}/pin-dep
Pin and install them? [Y/n] n
Try to install anyway, assuming `--ignore-pin-depends'? [Y/n] y
[ERROR] Package conflict!
  * Missing dependency:
    - deps-of-local-with-pin-deps -> pin-dep
    unknown package

No solution found, exiting
# Return code 20 #
### opam pin
### :I:1:d: Deps only with pin depends
### opam switch create pin-deps-I-1-d --empty
### OPAMAUTOANSWER=install-pin-depends=yes:proceed-actions=yes opam install --deps-only ./local-with-pin-deps
The following additional pinnings are required by local-with-pin-deps.dev:
  - pin-dep.dev at file://${BASEDIR}/pin-dep
Pin and install them? [Y/n] y
[NOTE] Package pin-dep does not exist in opam repositories registered in the current switch.
[pin-dep.dev] synchronised (no changes)
pin-dep is now pinned to file://${BASEDIR}/pin-dep (version dev)
The following actions will be performed:
=== install 1 package
  - install pin-dep dev (pinned) [required by local-with-pin-deps]

Proceed with 1 installation? [Y/n] y

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> retrieved pin-dep.dev  (file://${BASEDIR}/pin-dep)
-> installed pin-dep.dev
Done.
### opam pin
pin-dep.dev    rsync  file://${BASEDIR}/pin-dep
### :I:1:e: install without pin depends
### opam switch create pin-deps-I-1-e --empty
### OPAMAUTOANSWER=install-pin-depends=no:ignore-pin-depends=yes opam install ./local-with-pin-deps
[NOTE] Package local-with-pin-deps does not exist in opam repositories registered in the current switch.
The following additional pinnings are required by local-with-pin-deps.dev:
  - pin-dep.dev at file://${BASEDIR}/pin-dep
Pin and install them? [Y/n] n
Try to install anyway, assuming `--ignore-pin-depends'? [Y/n] y
local-with-pin-deps is now pinned to file://${BASEDIR}/local-with-pin-deps (version dev)
[ERROR] Package conflict!
  * Missing dependency:
    - local-with-pin-deps -> pin-dep
    unknown package

No solution found, exiting
# Return code 20 #
### opam pin
local-with-pin-deps.dev  (uninstalled)  rsync  file://${BASEDIR}/local-with-pin-deps
### :I:1:f: install with pin depends
### opam switch create pin-deps-I-1-f --empty
### OPAMAUTOANSWER=install-pin-depends=yes:proceed-actions=yes opam install ./local-with-pin-deps
[NOTE] Package local-with-pin-deps does not exist in opam repositories registered in the current switch.
The following additional pinnings are required by local-with-pin-deps.dev:
  - pin-dep.dev at file://${BASEDIR}/pin-dep
Pin and install them? [Y/n] y
[NOTE] Package pin-dep does not exist in opam repositories registered in the current switch.
[pin-dep.dev] synchronised (no changes)
pin-dep is now pinned to file://${BASEDIR}/pin-dep (version dev)
local-with-pin-deps is now pinned to file://${BASEDIR}/local-with-pin-deps (version dev)
The following actions will be performed:
=== install 2 packages
  - install local-with-pin-deps dev (pinned)
  - install pin-dep             dev (pinned) [required by local-with-pin-deps]

Proceed with 2 installations? [Y/n] y

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> retrieved local-with-pin-deps.dev  (file://${BASEDIR}/local-with-pin-deps)
-> retrieved pin-dep.dev  (file://${BASEDIR}/pin-dep)
-> installed pin-dep.dev
-> installed local-with-pin-deps.dev
Done.
### opam pin
local-with-pin-deps.dev    rsync  file://${BASEDIR}/local-with-pin-deps
pin-dep.dev                rsync  file://${BASEDIR}/pin-dep
### :I:2: Dependent package present in repo
### <pkg:pin-dep.1>
opam-version: "2.0"
### opam switch create pin-deps-w-repo-empty --empty
### :I:2:a: Show
### opam install --show ./local-with-pin-deps
The following actions would be performed:
=== install 2 packages
  - install local-with-pin-deps dev (pinned)
  - install pin-dep             1            [required by local-with-pin-deps]
### opam pin
### :I:2:b: Dry run
### OPAMAUTOANSWER=proceed-actions=yes opam install --dry-run ./local-with-pin-deps
The following actions will be simulated:
=== install 2 packages
  - install local-with-pin-deps dev (pinned)
  - install pin-dep             1            [required by local-with-pin-deps]

Proceed with 2 installations? [Y/n] y

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
Installing pin-dep.1.
-> installed pin-dep.1
Installing local-with-pin-deps.dev.
-> installed local-with-pin-deps.dev
Done.
### opam pin
### :I:2:c: Deps only without pin depends
### opam switch create pin-deps-I-2-c --empty
### OPAMAUTOANSWER=install-pin-depends=no:ignore-pin-depends=yes:proceed-actions=yes opam install --deps-only ./local-with-pin-deps
The following additional pinnings are required by local-with-pin-deps.dev:
  - pin-dep.dev at file://${BASEDIR}/pin-dep
Pin and install them? [Y/n] n
Try to install anyway, assuming `--ignore-pin-depends'? [Y/n] y
The following actions will be performed:
=== install 1 package
  - install pin-dep 1 [required by local-with-pin-deps]

Proceed with 1 installation? [Y/n] y

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> installed pin-dep.1
Done.
### opam pin
### :I:2:d: Deps only without pin depends
### opam switch create pin-deps-I-2-d --empty
### OPAMAUTOANSWER=install-pin-depends=yes:proceed-actions=yes opam install --deps-only ./local-with-pin-deps
The following additional pinnings are required by local-with-pin-deps.dev:
  - pin-dep.dev at file://${BASEDIR}/pin-dep
Pin and install them? [Y/n] y
[pin-dep.dev] synchronised (no changes)
pin-dep is now pinned to file://${BASEDIR}/pin-dep (version dev)
The following actions will be performed:
=== install 1 package
  - install pin-dep dev (pinned) [required by local-with-pin-deps]

Proceed with 1 installation? [Y/n] y

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> retrieved pin-dep.dev  (file://${BASEDIR}/pin-dep)
-> installed pin-dep.dev
Done.
### :I:2:e: install without pin depends
### opam switch create pin-deps-I-2-e --empty
### OPAMAUTOANSWER=install-pin-depends=no:ignore-pin-depends=yes:proceed-actions=yes opam install ./local-with-pin-deps
[NOTE] Package local-with-pin-deps does not exist in opam repositories registered in the current switch.
The following additional pinnings are required by local-with-pin-deps.dev:
  - pin-dep.dev at file://${BASEDIR}/pin-dep
Pin and install them? [Y/n] n
Try to install anyway, assuming `--ignore-pin-depends'? [Y/n] y
local-with-pin-deps is now pinned to file://${BASEDIR}/local-with-pin-deps (version dev)
The following actions will be performed:
=== install 2 packages
  - install local-with-pin-deps dev (pinned)
  - install pin-dep             1            [required by local-with-pin-deps]

Proceed with 2 installations? [Y/n] y

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> retrieved local-with-pin-deps.dev  (file://${BASEDIR}/local-with-pin-deps)
-> installed pin-dep.1
-> installed local-with-pin-deps.dev
Done.
### opam pin
local-with-pin-deps.dev    rsync  file://${BASEDIR}/local-with-pin-deps
### :I:2:f: install with pin depends
### opam switch create pin-deps-I-2-f --empty
### OPAMAUTOANSWER=install-pin-depends=yes:proceed-actions=yes opam install ./local-with-pin-deps
[NOTE] Package local-with-pin-deps does not exist in opam repositories registered in the current switch.
The following additional pinnings are required by local-with-pin-deps.dev:
  - pin-dep.dev at file://${BASEDIR}/pin-dep
Pin and install them? [Y/n] y
[pin-dep.dev] synchronised (no changes)
pin-dep is now pinned to file://${BASEDIR}/pin-dep (version dev)
local-with-pin-deps is now pinned to file://${BASEDIR}/local-with-pin-deps (version dev)
The following actions will be performed:
=== install 2 packages
  - install local-with-pin-deps dev (pinned)
  - install pin-dep             dev (pinned) [required by local-with-pin-deps]

Proceed with 2 installations? [Y/n] y

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> retrieved local-with-pin-deps.dev  (file://${BASEDIR}/local-with-pin-deps)
-> retrieved pin-dep.dev  (file://${BASEDIR}/pin-dep)
-> installed pin-dep.dev
-> installed local-with-pin-deps.dev
Done.
### opam pin
local-with-pin-deps.dev    rsync  file://${BASEDIR}/local-with-pin-deps
pin-dep.dev                rsync  file://${BASEDIR}/pin-dep
### :II: At switch creation
### :II:1: Dependency not known
### rm -r REPO/packages/pin-dep
### opam update default

<><> Updating package repositories ><><><><><><><><><><><><><><><><><><><><><><>
[default] synchronised from file://${BASEDIR}/REPO
Now run 'opam upgrade' to apply any package updates.
### :II:1:a: Answer no to pin depends install deps-only
### OPAMAUTOANSWER=install-pin-depends=no:ignore-pin-depends=yes:switch-clean-up=yes opam switch create ./local-with-pin-deps --deps-only
The following additional pinnings are required by local-with-pin-deps.dev:
  - pin-dep.dev at file://${BASEDIR}/pin-dep
Pin and install them? [Y/n] n
Try to install anyway, assuming `--ignore-pin-depends'? [Y/n] y

<><> Installing new switch packages <><><><><><><><><><><><><><><><><><><><><><>
Switch invariant: []
[ERROR] Could not determine which packages to install for this switch:
  * Missing dependency:
    - local-with-pin-deps -> pin-dep
    unknown package


Switch initialisation failed: clean up? ('n' will leave the switch partially installed) [Y/n] y
# Return code 20 #
### opam pin --switch=./local-with-pin-deps
[ERROR] The selected switch ${BASEDIR}/local-with-pin-deps is not installed.
# Return code 2 #
### opam switch remove ./local-with-pin-deps -y
The compiler switch ${BASEDIR}/local-with-pin-deps does not exist.
# Return code 5 #
### :II:1:b: Answer no to pin depends install
### OPAMAUTOANSWER=install-pin-depends=no:ignore-pin-depends=yes:switch-clean-up=yes opam switch create ./local-with-pin-deps
[NOTE] Package local-with-pin-deps does not exist in opam repositories registered in the current switch.
The following additional pinnings are required by local-with-pin-deps.dev:
  - pin-dep.dev at file://${BASEDIR}/pin-dep
Pin and install them? [Y/n] n
Try to install anyway, assuming `--ignore-pin-depends'? [Y/n] y
local-with-pin-deps is now pinned to file://${BASEDIR}/local-with-pin-deps (version dev)

<><> Installing new switch packages <><><><><><><><><><><><><><><><><><><><><><>
Switch invariant: []
[ERROR] Could not determine which packages to install for this switch:
  * Missing dependency:
    - local-with-pin-deps -> pin-dep
    unknown package


Switch initialisation failed: clean up? ('n' will leave the switch partially installed) [Y/n] y
# Return code 20 #
### opam pin --switch=./local-with-pin-deps
[ERROR] The selected switch ${BASEDIR}/local-with-pin-deps is not installed.
# Return code 2 #
### opam switch remove ./local-with-pin-deps -y
The compiler switch ${BASEDIR}/local-with-pin-deps does not exist.
# Return code 5 #
### :II:1:c: Answer yes to pin depends install deps-only
### OPAMAUTOANSWER=install-pin-depends=yes:proceed-actions=yes:switch-clean-up=yes opam switch create ./local-with-pin-deps --deps-only
The following additional pinnings are required by local-with-pin-deps.dev:
  - pin-dep.dev at file://${BASEDIR}/pin-dep
Pin and install them? [Y/n] y
[NOTE] Package pin-dep does not exist in opam repositories registered in the current switch.
[pin-dep.dev] synchronised (no changes)
pin-dep is now pinned to file://${BASEDIR}/pin-dep (version dev)

<><> Installing new switch packages <><><><><><><><><><><><><><><><><><><><><><>
Switch invariant: []
[NOTE] No invariant was set, you may want to use `opam switch set-invariant' to keep a stable compiler version on upgrades.
The following actions will be performed:
=== install 1 package
  - install pin-dep dev (pinned) [required by local-with-pin-deps]

Proceed with 1 installation? [Y/n] y

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> retrieved pin-dep.dev  (file://${BASEDIR}/pin-dep)
-> installed pin-dep.dev
Done.
### opam pin --switch=./local-with-pin-deps
pin-dep.dev    rsync  file://${BASEDIR}/pin-dep
### opam switch remove ./local-with-pin-deps -y
Switch ${BASEDIR}/local-with-pin-deps and all its packages will be wiped. Are you sure? [Y/n] y
### :II:1:d: Answer yes to pin depends install
### OPAMAUTOANSWER=install-pin-depends=yes:proceed-actions=yes opam switch create ./local-with-pin-deps
[NOTE] Package local-with-pin-deps does not exist in opam repositories registered in the current switch.
The following additional pinnings are required by local-with-pin-deps.dev:
  - pin-dep.dev at file://${BASEDIR}/pin-dep
Pin and install them? [Y/n] y
[NOTE] Package pin-dep does not exist in opam repositories registered in the current switch.
[pin-dep.dev] synchronised (no changes)
pin-dep is now pinned to file://${BASEDIR}/pin-dep (version dev)
local-with-pin-deps is now pinned to file://${BASEDIR}/local-with-pin-deps (version dev)

<><> Installing new switch packages <><><><><><><><><><><><><><><><><><><><><><>
Switch invariant: []
[NOTE] No invariant was set, you may want to use `opam switch set-invariant' to keep a stable compiler version on upgrades.
The following actions will be performed:
=== install 2 packages
  - install local-with-pin-deps dev (pinned)
  - install pin-dep             dev (pinned) [required by local-with-pin-deps]

Proceed with 2 installations? [Y/n] y

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> retrieved local-with-pin-deps.dev  (file://${BASEDIR}/local-with-pin-deps)
-> retrieved pin-dep.dev  (file://${BASEDIR}/pin-dep)
-> installed pin-dep.dev
-> installed local-with-pin-deps.dev
Done.
### opam pin --switch=./local-with-pin-deps
local-with-pin-deps.dev    rsync  file://${BASEDIR}/local-with-pin-deps
pin-dep.dev                rsync  file://${BASEDIR}/pin-dep
### opam switch remove ./local-with-pin-deps -y
Switch ${BASEDIR}/local-with-pin-deps and all its packages will be wiped. Are you sure? [Y/n] y
### :II:2: Dependency known
### <pkg:pin-dep.1>
opam-version: "2.0"
### :II:2:a: Answer no to pin depends install deps only
### OPAMAUTOANSWER=install-pin-depends=no:ignore-pin-depends=yes:proceed-actions=yes opam switch create ./local-with-pin-deps --deps-only
The following additional pinnings are required by local-with-pin-deps.dev:
  - pin-dep.dev at file://${BASEDIR}/pin-dep
Pin and install them? [Y/n] n
Try to install anyway, assuming `--ignore-pin-depends'? [Y/n] y

<><> Installing new switch packages <><><><><><><><><><><><><><><><><><><><><><>
Switch invariant: []
[NOTE] No invariant was set, you may want to use `opam switch set-invariant' to keep a stable compiler version on upgrades.
The following actions will be performed:
=== install 1 package
  - install pin-dep 1 [required by local-with-pin-deps]

Proceed with 1 installation? [Y/n] y

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> installed pin-dep.1
Done.
### opam pin --switch=./local-with-pin-deps
### opam switch remove ./local-with-pin-deps -y
Switch ${BASEDIR}/local-with-pin-deps and all its packages will be wiped. Are you sure? [Y/n] y
### :II:2:b: Answer no to pin depends install
### OPAMAUTOANSWER=install-pin-depends=no:ignore-pin-depends=yes:proceed-actions=yes opam switch create ./local-with-pin-deps
[NOTE] Package local-with-pin-deps does not exist in opam repositories registered in the current switch.
The following additional pinnings are required by local-with-pin-deps.dev:
  - pin-dep.dev at file://${BASEDIR}/pin-dep
Pin and install them? [Y/n] n
Try to install anyway, assuming `--ignore-pin-depends'? [Y/n] y
local-with-pin-deps is now pinned to file://${BASEDIR}/local-with-pin-deps (version dev)

<><> Installing new switch packages <><><><><><><><><><><><><><><><><><><><><><>
Switch invariant: []
[NOTE] No invariant was set, you may want to use `opam switch set-invariant' to keep a stable compiler version on upgrades.
The following actions will be performed:
=== install 2 packages
  - install local-with-pin-deps dev (pinned)
  - install pin-dep             1            [required by local-with-pin-deps]

Proceed with 2 installations? [Y/n] y

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> retrieved local-with-pin-deps.dev  (file://${BASEDIR}/local-with-pin-deps)
-> installed pin-dep.1
-> installed local-with-pin-deps.dev
Done.
### opam pin --switch=./local-with-pin-deps
local-with-pin-deps.dev    rsync  file://${BASEDIR}/local-with-pin-deps
### opam switch remove ./local-with-pin-deps -y
Switch ${BASEDIR}/local-with-pin-deps and all its packages will be wiped. Are you sure? [Y/n] y
### :II:2:c: Answer yes to pin depends install deps-only
### OPAMAUTOANSWER=install-pin-depends=yes:proceed-actions=yes opam switch create ./local-with-pin-deps --deps-only
The following additional pinnings are required by local-with-pin-deps.dev:
  - pin-dep.dev at file://${BASEDIR}/pin-dep
Pin and install them? [Y/n] y
[pin-dep.dev] synchronised (no changes)
pin-dep is now pinned to file://${BASEDIR}/pin-dep (version dev)

<><> Installing new switch packages <><><><><><><><><><><><><><><><><><><><><><>
Switch invariant: []
[NOTE] No invariant was set, you may want to use `opam switch set-invariant' to keep a stable compiler version on upgrades.
The following actions will be performed:
=== install 1 package
  - install pin-dep dev (pinned) [required by local-with-pin-deps]

Proceed with 1 installation? [Y/n] y

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> retrieved pin-dep.dev  (file://${BASEDIR}/pin-dep)
-> installed pin-dep.dev
Done.
### opam pin --switch=./local-with-pin-deps
pin-dep.dev    rsync  file://${BASEDIR}/pin-dep
### opam switch remove ./local-with-pin-deps -y
Switch ${BASEDIR}/local-with-pin-deps and all its packages will be wiped. Are you sure? [Y/n] y
### :II:2:d: Answer yes to pin depends install
### OPAMAUTOANSWER=install-pin-depends=yes:proceed-actions=yes opam switch create ./local-with-pin-deps
[NOTE] Package local-with-pin-deps does not exist in opam repositories registered in the current switch.
The following additional pinnings are required by local-with-pin-deps.dev:
  - pin-dep.dev at file://${BASEDIR}/pin-dep
Pin and install them? [Y/n] y
[pin-dep.dev] synchronised (no changes)
pin-dep is now pinned to file://${BASEDIR}/pin-dep (version dev)
local-with-pin-deps is now pinned to file://${BASEDIR}/local-with-pin-deps (version dev)

<><> Installing new switch packages <><><><><><><><><><><><><><><><><><><><><><>
Switch invariant: []
[NOTE] No invariant was set, you may want to use `opam switch set-invariant' to keep a stable compiler version on upgrades.
The following actions will be performed:
=== install 2 packages
  - install local-with-pin-deps dev (pinned)
  - install pin-dep             dev (pinned) [required by local-with-pin-deps]

Proceed with 2 installations? [Y/n] y

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> retrieved local-with-pin-deps.dev  (file://${BASEDIR}/local-with-pin-deps)
-> retrieved pin-dep.dev  (file://${BASEDIR}/pin-dep)
-> installed pin-dep.dev
-> installed local-with-pin-deps.dev
Done.
### opam pin --switch=./local-with-pin-deps
local-with-pin-deps.dev    rsync  file://${BASEDIR}/local-with-pin-deps
pin-dep.dev                rsync  file://${BASEDIR}/pin-dep
### opam switch remove ./local-with-pin-deps -y
Switch ${BASEDIR}/local-with-pin-deps and all its packages will be wiped. Are you sure? [Y/n] y
